
# Tests are organized by chapter increments, or logical groups

chapters:
  echo chap8.list  >> $out  #        69
  echo chap9.list  >> $out  # +27 =  96
  echo chap10.list >> $out  # +43 = 139
  #echo chap11.list >> $out  #  +8 = 147
  #echo chap12.list >> $out  # +60 = 207
  #echo chap13.list >> $out  # +32 = 239

groups:
  echo parse-error.list          >> $out  #  40
  echo resolve-error.list        >> $out  #  12
  echo runtime-error.list        >> $out  #  61
  echo successful-execution.list >> $out  # 127
                                          #-----
                                          # 239

fullpath.list: @chapters
  cat *.list | sed 's/#.*//' | grep -v '^ *$$' | sed 's|^|/home/nic/other/craftinginterpreters/|' >> $out
  #echo /home/nic/code/lox/examples/lambda.lox >> $out
  echo /home/nic/code/lox/examples/fib-iter.lox >> $out
  echo /home/nic/code/lox/examples/thrice.lox >> $out

# T: Tree walk interpreter.
# H: Bytecode compiler + haskell VM.
# C: Bytecode compiler + C VM.

T.sh :: echo './lox.exe -tree $$@' >> $out; chmod +x $out
H.sh :: echo './lox.exe -bci $$@' >> $out; chmod +x $out
C.sh :: echo './lox.exe -export code.bin $$@ && ./vm.exe code.bin' >> $out; chmod +x $out

deps-for-T :: echo ../src/lox.exe >> $out
deps-for-H :: echo ../src/lox.exe >> $out
deps-for-C :: echo ../src/lox.exe ../c/vm.exe >> $out

rules : fullpath.list rules.sh
  ./rules.sh < $in > $out

include rules

reference-lox : ~/other/craftinginterpreters/clox : ln $in $out
